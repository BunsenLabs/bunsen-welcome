ADD_BACKPORTS_TITLE=$"Debian Backports"
ADD_BACKPORTS_TEXT=$"Debian backports are packages taken from the next Debian release (called \"testing\"), adjusted and recompiled for usage on Debian stable.\
 If you enable this repository you will be able to upgrade some programs to newer versions, or install some programs not available in Debian stable.

However, backports cannot be tested as extensively as Debian stable, and are provided on an as-is basis, with risk of incompatibilities with other components in Debian stable.\
 It is therefore recommended to only select single backported packages that fit your needs, and not use all available backports.

This will add the line:

 deb $default_mirror ${debian_base}-backports main contrib non-free non-free-firmware

to /etc/apt/sources.list.d/debian-${debian_base}-backports.list,
allowing you to upgrade or install packages using that repository."
ADD_BACKPORTS_PROMPT=$"Would you like to enable the Debian Backports repositories?"
ADD_BACKPORTS_EXTRA_ARG='N'

# use key in global array repo_status generated by getRepoStatus() in 'apt-update-check-upgrade' or 'restart'
haveDebianBackports() {
    [[ -n ${repo_status[deb_bkpt_main]-} ]] && return 0
    return 1
}

addDebianBackports() {
    local bp_repo_msg bp_repo_line bp_repo_file
    if haveDebianBackports
    then
        say 'Debian backports have already been added to apt sources.' 2
    else
        say $'\nAdding Debian backports to apt sources...\n' 1
        bp_repo_msg='# added by bl-welcome
# Debian backports
'
        bp_repo_line="deb $default_mirror ${debian_base}-backports main contrib non-free non-free-firmware"
        bp_repo_file="/etc/apt/sources.list.d/debian-${debian_base}-backports.list"
        sudo tee <<< "${bp_repo_msg}${bp_repo_line}"$'\n' "$bp_repo_file" >/dev/null
        grep -q "^${bp_repo_line}\$" "$bp_repo_file" || {
            say 'Failed to add Debian backports to apt sources.' pause >&2
            return 1
        }
        if grep -q "${debian_base}-backports" /etc/apt/sources.list
        then
            say $'\ncommenting out obsolete backports entries in /etc/apt/sources.list...'
            local bkp_list=/etc/apt/sources.list"$bkp_sfx"
            sudo cp /etc/apt/sources.list "$bkp_list"
            sed "/${debian_base}-backports/ s/^/#/" "$bkp_list" | sudo tee /etc/apt/sources.list >/dev/null
        fi
        triggerAptUpdate
    fi
}

if haveDebianBackports
then
    setupPage "$ADD_BACKPORTS_TITLE" $"Debian backports have already been added to apt sources."
else
    if setupPage "$ADD_BACKPORTS_TITLE" "$ADD_BACKPORTS_TEXT" "$ADD_BACKPORTS_PROMPT" "$ADD_BACKPORTS_EXTRA_ARG"; then
        if addDebianBackports
        then
            say "Successfully added Debian backports.\
 You can add or upgrade packages with the command:
 sudo apt-get install -t ${debian_base}-backports <packagename>" pause
        else
            say "Failed to add backports, going to next page." 3
        fi
    fi
fi
